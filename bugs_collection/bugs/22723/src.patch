diff --git a/buggy/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/client/code/AuthorizationCodeAccessTokenProvider.java b/fixed/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/client/code/AuthorizationCodeAccessTokenProvider.java
index 2b370923a..e384ace6c 100644
--- a/buggy/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/client/code/AuthorizationCodeAccessTokenProvider.java
+++ b/fixed/spring-security-oauth2/src/main/java/org/springframework/security/oauth2/client/code/AuthorizationCodeAccessTokenProvider.java
@@ -56,10 +56,10 @@ public class AuthorizationCodeAccessTokenProvider extends OAuth2AccessTokenSuppo
 		form.add("code", context.getAuthorizationCode());
 
 		String redirectUri = resource.getPreEstablishedRedirectUri();
-		if (redirectUri == null) {
+		if (context!=null && redirectUri == null) {
 			// no pre-established redirect uri: use the preserved state
 			// TODO: treat redirect URI as a special kind of state (this is a historical mini hack)
-			redirectUri = String.valueOf(context==null ? null : context.getPreservedState());
+			redirectUri = String.valueOf(context.getPreservedState());
 		} else {
 			// TODO: the state key is what should be sent, not the value
 			form.add("state", String.valueOf(context.getPreservedState()));
