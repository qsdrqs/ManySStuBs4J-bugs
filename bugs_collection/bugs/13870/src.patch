diff --git a/buggy/presto-main/src/main/java/com/facebook/presto/connector/ConnectorManager.java b/fixed/presto-main/src/main/java/com/facebook/presto/connector/ConnectorManager.java
index 55a85f398..7c2cf95ce 100644
--- a/buggy/presto-main/src/main/java/com/facebook/presto/connector/ConnectorManager.java
+++ b/fixed/presto-main/src/main/java/com/facebook/presto/connector/ConnectorManager.java
@@ -98,7 +98,7 @@ public class ConnectorManager
     @PreDestroy
     public void stop()
     {
-        if (stopped.compareAndSet(false, true)) {
+        if (stopped.getAndSet(true)) {
             return;
         }
 
