diff --git a/buggy/transport/src/main/java/io/netty/channel/DefaultChannelHandlerContext.java b/fixed/transport/src/main/java/io/netty/channel/DefaultChannelHandlerContext.java
index d63d4df7c..d7a7940f3 100644
--- a/buggy/transport/src/main/java/io/netty/channel/DefaultChannelHandlerContext.java
+++ b/fixed/transport/src/main/java/io/netty/channel/DefaultChannelHandlerContext.java
@@ -1651,7 +1651,7 @@ final class DefaultChannelHandlerContext extends DefaultAttributeMap implements
         }
 
         private void flush(ByteBuf out) {
-            while (out.isWritable()) {
+            while (out.maxCapacity() != out.writerIndex()) {
                 ByteBuf data = exchangeBuf.peek();
                 if (data == null) {
                     break;
