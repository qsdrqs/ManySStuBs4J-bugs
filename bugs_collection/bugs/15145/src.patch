diff --git a/buggy/lib/rhino/src/org/mozilla/javascript/NativeJSON.java b/fixed/lib/rhino/src/org/mozilla/javascript/NativeJSON.java
index 1337d91d8..b342ca7f4 100644
--- a/buggy/lib/rhino/src/org/mozilla/javascript/NativeJSON.java
+++ b/fixed/lib/rhino/src/org/mozilla/javascript/NativeJSON.java
@@ -307,7 +307,7 @@ public final class NativeJSON extends IdScriptableObject
 
         if (value instanceof Number) {
             double d = ((Number) value).doubleValue();
-            if (d == d && d != Double.POSITIVE_INFINITY &&
+            if (!Double.isNaN(d) && d != Double.POSITIVE_INFINITY &&
                 d != Double.NEGATIVE_INFINITY)
             {
                 return ScriptRuntime.toString(value);
