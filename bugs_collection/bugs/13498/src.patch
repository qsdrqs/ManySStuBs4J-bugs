diff --git a/buggy/presto-main/src/main/java/com/facebook/presto/sql/planner/iterative/rule/MergeLimitWithDistinct.java b/fixed/presto-main/src/main/java/com/facebook/presto/sql/planner/iterative/rule/MergeLimitWithDistinct.java
index 3030658d3..40f39e409 100644
--- a/buggy/presto-main/src/main/java/com/facebook/presto/sql/planner/iterative/rule/MergeLimitWithDistinct.java
+++ b/fixed/presto-main/src/main/java/com/facebook/presto/sql/planner/iterative/rule/MergeLimitWithDistinct.java
@@ -45,7 +45,7 @@ public class MergeLimitWithDistinct
 
         AggregationNode child = (AggregationNode) input;
 
-        if (isDistinct(child)) {
+        if (!isDistinct(child)) {
             return Optional.empty();
         }
 
@@ -64,8 +64,8 @@ public class MergeLimitWithDistinct
      */
     private boolean isDistinct(AggregationNode node)
     {
-        return !node.getAggregations().isEmpty() ||
-                node.getOutputSymbols().size() != node.getGroupingKeys().size() ||
-                !node.getOutputSymbols().containsAll(node.getGroupingKeys());
+        return node.getAggregations().isEmpty() &&
+                node.getOutputSymbols().size() == node.getGroupingKeys().size() &&
+                node.getOutputSymbols().containsAll(node.getGroupingKeys());
     }
 }
