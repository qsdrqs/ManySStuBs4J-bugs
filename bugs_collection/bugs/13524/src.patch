diff --git a/buggy/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/StreamPropertyDerivations.java b/fixed/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/StreamPropertyDerivations.java
index ba6d14204..e85b10db8 100644
--- a/buggy/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/StreamPropertyDerivations.java
+++ b/fixed/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/StreamPropertyDerivations.java
@@ -494,7 +494,7 @@ final class StreamPropertyDerivations
         @Override
         public StreamProperties visitApply(ApplyNode node, List<StreamProperties> inputProperties)
         {
-            return inputProperties.get(0);
+            throw new IllegalStateException("Unexpected node: " + node.getClass());
         }
 
         @Override
