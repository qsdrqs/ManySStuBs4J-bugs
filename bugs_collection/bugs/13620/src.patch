diff --git a/buggy/presto-main/src/main/java/com/facebook/presto/operator/PartitionedLookupSource.java b/fixed/presto-main/src/main/java/com/facebook/presto/operator/PartitionedLookupSource.java
index 9bc39ccf7..c3b497ada 100644
--- a/buggy/presto-main/src/main/java/com/facebook/presto/operator/PartitionedLookupSource.java
+++ b/fixed/presto-main/src/main/java/com/facebook/presto/operator/PartitionedLookupSource.java
@@ -154,7 +154,7 @@ public class PartitionedLookupSource
 
     private long encodePartitionedJoinPosition(int partition, int joinPosition)
     {
-        return (joinPosition << shiftSize) | (partition);
+        return (((long) joinPosition) << shiftSize) | (partition);
     }
 
     private static class PartitionedLookupOuterPositionIterator
