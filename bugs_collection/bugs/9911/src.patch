diff --git a/buggy/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExp.java b/fixed/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExp.java
index 38360f5cb..516e4775b 100644
--- a/buggy/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExp.java
+++ b/fixed/ql/src/java/org/apache/hadoop/hive/ql/udf/UDFRegExp.java
@@ -38,7 +38,7 @@ public class UDFRegExp extends UDF {
     if (s == null || regex == null) {
       return null;
     }
-    if (!regex.equals(lastRegex)) {
+    if (!regex.equals(lastRegex) || p == null) {
       lastRegex.set(regex);
       p = Pattern.compile(regex.toString());
     }
