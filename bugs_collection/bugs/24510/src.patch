diff --git a/buggy/undertow/src/main/java/org/wildfly/extension/undertow/deployment/UndertowDeploymentProcessor.java b/fixed/undertow/src/main/java/org/wildfly/extension/undertow/deployment/UndertowDeploymentProcessor.java
index 285752335..acdf8b6c3 100644
--- a/buggy/undertow/src/main/java/org/wildfly/extension/undertow/deployment/UndertowDeploymentProcessor.java
+++ b/fixed/undertow/src/main/java/org/wildfly/extension/undertow/deployment/UndertowDeploymentProcessor.java
@@ -400,7 +400,7 @@ public class UndertowDeploymentProcessor implements DeploymentUnitProcessor {
     private static ServiceName installSessionManagerFactory(ServiceTarget target, ServiceName deploymentServiceName, String deploymentName, Module module, JBossWebMetaData metaData, ServletContainerService servletContainerService) {
 
         Integer maxActiveSessions = metaData.getMaxActiveSessions();
-        if(maxActiveSessions == null) {
+        if(maxActiveSessions == null && servletContainerService != null) {
             maxActiveSessions = servletContainerService.getMaxSessions();
         }
         ServiceName name = deploymentServiceName.append("session");
