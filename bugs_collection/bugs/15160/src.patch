diff --git a/buggy/lib/rhino/src/org/mozilla/javascript/optimizer/Codegen.java b/fixed/lib/rhino/src/org/mozilla/javascript/optimizer/Codegen.java
index 4e18d5dd3..b484f70a0 100644
--- a/buggy/lib/rhino/src/org/mozilla/javascript/optimizer/Codegen.java
+++ b/fixed/lib/rhino/src/org/mozilla/javascript/optimizer/Codegen.java
@@ -1072,7 +1072,7 @@ public class Codegen implements Evaluator
                     "org/mozilla/javascript/optimizer/OptRuntime",
                     "minusOneObj", "Ljava/lang/Double;");
 
-        } else if (num != num) {
+        } else if (Double.isNaN(num)) {
             cfw.add(ByteCode.GETSTATIC,
                     "org/mozilla/javascript/ScriptRuntime",
                     "NaNobj", "Ljava/lang/Double;");
