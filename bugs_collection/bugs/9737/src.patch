diff --git a/buggy/ql/src/java/org/apache/hadoop/hive/ql/udf/ptf/WindowingTableFunction.java b/fixed/ql/src/java/org/apache/hadoop/hive/ql/udf/ptf/WindowingTableFunction.java
index cebaf45cd..0423466d5 100644
--- a/buggy/ql/src/java/org/apache/hadoop/hive/ql/udf/ptf/WindowingTableFunction.java
+++ b/fixed/ql/src/java/org/apache/hadoop/hive/ql/udf/ptf/WindowingTableFunction.java
@@ -1190,7 +1190,7 @@ public class WindowingTableFunction extends TableFunctionEvaluator {
           (PrimitiveObjectInspector) expressionDef.getOI());
       String s2 = PrimitiveObjectInspectorUtils.getString(v2,
           (PrimitiveObjectInspector) expressionDef.getOI());
-      return (s1 == null && s2 == null) || s1.equals(s2);
+      return (s1 == null && s2 == null) || (s1 != null && s1.equals(s2));
     }
   }
 
